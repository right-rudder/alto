---
import Header from "../components/Header.astro";
import BaseLayout from "../layouts/BaseLayout.astro";
const headerData = {
  title: "Contact Us",
  headerImage: "/src/assets/alto-flight-yukon-group-photo.jpg",
  headerAlt: "CFI in Cessna",
};
import { IoPhonePortraitOutline } from "react-icons/io5";
import { IoLocationOutline } from "react-icons/io5";
import { TfiEmail } from "react-icons/tfi";

import {
  PHONE_NUMBER,
  AIRPORT,
  ADDRESS_LINE_1,
  ADDRESS_LINE_2,
  EMAIL_ADDRESS,
} from "../consts";

const CONTACT_US_FORM_WEBHOOK_URL = import.meta.env.CONTACT_US_FORM_WEBHOOK_URL;
const PORTAL_API_KEY = import.meta.env.PORTAL_API_KEY;
---

<BaseLayout
  siteTitle="Contact Us | Alto Flight Academy Yukon, OK"
  siteDescription="Begin your pilot career today.  Contact us and speak to an Alto Flight team member.  Whether you're just starting out, or you are looking for advanced training in instrument, commercial, CFI, or ATP; we can help you get to the skies quicker.  Alto Flight Academy is conveniently located in Oklahoma City, OK."
>
  <Header slot="header" data={headerData} />
  <div class="flex flex-col-reverse lg:flex-col">
    <section class="py-16 px-5 relative overflow-hidden bg-dark-blue">
      <div
        class="max-w-7xl mx-auto z-20 relative text-dark-blue flex justify-between lg:items-center items-start flex-col lg:flex-row gap-10"
      >
        <div class="flex">
          <IoPhonePortraitOutline className="lg:size-16 size-12 text-red-700" />
          <div class="flex flex-col justify-between font-semibold">
            <a class="text-white font-bold text-2xl" href=`tel:${PHONE_NUMBER}`
              >{PHONE_NUMBER}</a
            >
            <div class="flex flex-col text-gray-300">
              <p>Monday: 9.00am - 6.00pm</p>
              <p>Tuesday â€” Saturday: 8.00am - 6.00pm</p>
              <p>Sunday: 12.00pm - 6.00pm</p>
            </div>
          </div>
        </div>
        <div class="flex">
          <IoLocationOutline className="lg:size-16 size-12 text-red-700" />
          <div class="flex flex-col justify-between font-semibold">
            <a
              class="text-white font-bold text-2xl"
              href="https://maps.app.goo.gl/jV2NSfU3mHNMf2Rc7"
              target="_blank">{AIRPORT}</a
            >
            <div class="flex flex-col text-gray-300">
              <p>{ADDRESS_LINE_1}</p>
              <p>{ADDRESS_LINE_2}</p>
            </div>
          </div>
        </div>
        <div class="flex gap-5">
          <TfiEmail className="lg:size-16 size-12 text-red-700" />
          <div class="flex flex-col justify-between font-semibold">
            <a
              class="text-white font-bold text-2xl"
              href={`mailto:${EMAIL_ADDRESS}`}
              target="_blank">Email Us</a
            >
            <div class="flex flex-col text-gray-300">
              <a href={`mailto:${EMAIL_ADDRESS}`} target="_blank"
                >{EMAIL_ADDRESS}</a
              >
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="py-24 px-5">
      <div class="max-w-7xl mx-auto">
        <h2 class="text-dark-blue text-5xl font-extrabold mx-auto w-fit">
          Get in touch
        </h2>
        <form
          id="contact-form"
          class="flex flex-col max-w-4xl mx-auto gap-5 my-5"
        >
          <div class="flex flex-col lg:flex-row gap-5">
            <input
              type="text"
              name="first-name"
              placeholder="Your first name"
              class="px-5 py-4 outline-1 w-full border-gray-400 border outline-gray-500 rounded-full"
              required
            />
            <input
              type="text"
              name="last-name"
              placeholder="Your last name"
              class="px-5 py-4 outline-1 w-full border-gray-400 border outline-gray-500 rounded-full"
              required
            />
          </div>
          <div class="flex flex-col lg:flex-row gap-5">
            <input
              id="email"
              type="email"
              name="email"
              placeholder="Your email"
              class="px-5 py-4 outline-1 w-full border-gray-400 border outline-gray-500 rounded-full"
              required
            />
            <input
              type="email"
              name="confirm-email"
              placeholder="Confirm email"
              class="hidden px-5 py-4 outline-1 w-full border-gray-400 border outline-gray-500 rounded-full"
            />
            <input
              type="tel"
              name="phone"
              placeholder="Your phone number"
              class="px-5 py-4 outline-1 w-full border-gray-400 border outline-gray-500 rounded-full"
              required
            />
          </div>

          <textarea
            required
            name="message"
            placeholder="Your message"
            class="px-5 py-4 outline-1 border-gray-400 border outline-gray-500 rounded-xl min-h-48"
          ></textarea>

          <div class="flex gap-3">
            <input
              type="checkbox"
              name="agree-data-collection"
              id="agree-data-collection"
            />

            <label
              for="agree-data-collection"
              class="text-gray-500 text-sm lg:text-base"
            >
              I agree to the terms & conditions provided by the company. By
              providing my phone number, I agree to receive text messages from
              Alto Flight Academy.
            </label>
          </div>
          <button
            id="submit-button"
            disabled
            type="submit"
            class="btn-dark-blue mx-auto cursor-not-allowed bg-gray-400 hover:bg-gray-400"
            >Send message</button
          >
        </form>
      </div>
    </section>
  </div>

  <iframe
    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3244.057927577292!2d-97.710454723616!3d35.60163763434128!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x87b2014e29c352e9%3A0x466ca3f4081dcdf5!2sAlto%20Flight%20Academy!5e0!3m2!1sen!2sgt!4v1715928246714!5m2!1sen!2sgt"
    class="w-full h-[20rem]"
    style="border:0;"
    allowfullscreen=""
    loading="lazy"
    referrerpolicy="no-referrer-when-downgrade"
    title="Alto Flight Academy Location"></iframe>

  <script define:vars={{ CONTACT_US_FORM_WEBHOOK_URL, PORTAL_API_KEY }}>
    const checkbox = document.getElementById("agree-data-collection");
    const submitButton = document.getElementById("submit-button");

    checkbox.addEventListener("change", function () {
      if (checkbox.checked) {
        submitButton.disabled = false;
        submitButton.classList.remove(
          "cursor-not-allowed",
          "bg-gray-400",
          "hover:bg-gray-400",
        );
      } else {
        submitButton.disabled = true;
        submitButton.classList.add(
          "cursor-not-allowed",
          "bg-gray-400",
          "hover:bg-gray-400",
        );
      }
    });

    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("contact-form");
      if (!form) {
        console.error("Form element not found.");
        return;
      }

      form.addEventListener("submit", async (event) => {
        event.preventDefault();

        const formData = new FormData(form);
        const confirmEmail = formData.get("confirm-email")?.trim();

        if (confirmEmail) return;

        const webhookURL = CONTACT_US_FORM_WEBHOOK_URL;
        const apiKey = PORTAL_API_KEY;

        const urlEncodedBody = new URLSearchParams(formData).toString();

        const jsonBody = {
          first_name: formData.get("first-name")?.trim() || "",
          last_name: formData.get("last-name")?.trim() || "",
          email: formData.get("email")?.trim() || "",
          phone: formData.get("phone")?.trim() || "",
          campaign: "contact_us",
          account_random_id: "ac_xbpzsoyp",
          metadata: {
            message: formData.get("message")?.trim() || "",
          },
        };

        try {
          const [ghlRes, portalRes] = await Promise.all([
            fetch(webhookURL, {
              method: "POST",
              headers: {
                "Content-Type": "application/x-www-form-urlencoded",
              },
              body: urlEncodedBody,
            }),
            fetch("https://portal.rightruddermarketing.com/api/leads", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Accept: "application/json",
                "x-api-key": apiKey,
              },
              body: JSON.stringify(jsonBody),
            }),
          ]);

          if (ghlRes.ok && portalRes.ok) {
            window.location.href = "/contact-confirmation";
          } else {
            console.error("Submission failed", {
              ghlStatus: ghlRes.status,
              portalStatus: portalRes.status,
            });
          }
        } catch (err) {
          console.error("Submission error:", err);
        }
      });
    });
  </script>

  <script src="../scripts/emailValidation.js"></script>
</BaseLayout>
